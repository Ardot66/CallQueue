BIN = Bin
SOURCE = Source
TEMP = Temp
TESTS = Tests

THREADCALLNAME = ThreadCall
TESTSNAME = Tests

THREADCALLDLL = $(BIN)/lib$(THREADCALLNAME).dll
TESTSEXE = $(BIN)/$(TESTSNAME).exe

All: $(THREADCALLDLL) $(TESTSEXE)
	$(TESTSEXE)

$(THREADCALLDLL) : $(SOURCE)/$(THREADCALLNAME).c
	gcc -c -fPIC $(SOURCE)/$(THREADCALLNAME).c -o $(TEMP)/$(THREADCALLNAME).o
	gcc -shared $(TEMP)/$(THREADCALLNAME).o -lpthread -o $(THREADCALLDLL)

$(TESTSEXE) : $(TESTS)/$(TESTSNAME).c
	gcc -c $(TESTS)/$(TESTSNAME).c -o $(TEMP)/$(TESTSNAME).o
	gcc -I$(SOURCE) -L$(BIN) -lThreadCall $(TEMP)/$(TESTSNAME).o -o $(TESTSEXE)

Clean:
	DEL /Q $(BIN)\*.dll $(BIN)\*.exe
	DEL /Q $(TEMP)\*.o